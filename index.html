<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Charlie Carter" />


<title>CalMatters Code Resume</title>

<script type="text/javascript">
$(window).load(function() {
    $('.preload').attr('src', function(i,a){
        $(this).attr('src','').removeClass('preload').attr('src',a);
    });
});
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="section-header">



<h1 class="title toc-ignore">CalMatters Code Resume</h1>
<h4 class="author"><em>Charlie Carter</em></h4>

</div>


<div id="section-crime-report-heatmap" class="section level1 tabset tabset-fade tabset-pills">
<h1>Crime Report Heatmap</h1>
<div id="section-map" class="section level2">
<h2>Map</h2>
<h5>
Los Angeles Crime Report Heatmap (2010 - 2019):
</h5>
<p><img src="https://github.com/CharlieCarter/CharlieCarter.github.io/blob/master/animated_crime_la.gif?raw=true"></p>
</div>
<div id="section-code" class="section level2">
<h2>Code</h2>
<pre class="r"><code># Crime Data from 2010 to Present
# From https://data.lacity.org/A-Safe-City/Crime-Data-from-2010-to-Present/y8tr-7khq/data

#### Heatmap Attempt #### 

crime &lt;- read.csv(&quot;/Users/charliecarter/Downloads/Crime_Data_from_2010_to_Present.csv&quot;,
                  stringsAsFactors = F)

## Parallel Computing To Derive Latitude and Longitude Quickly ####
library(parallel)
no_cores &lt;- detectCores() - 1
cl &lt;- makeCluster(no_cores)

## get lat
crime$lat &lt;- parLapply(cl, X = crime$Location, fun = function(x) {
  as.numeric(
    unlist(
      strsplit(substr(x, 2, nchar(x) - 1), 
               split= &quot;, &quot;)[[1]][1] 
    )
  )
})

## get lon
crime$lon &lt;- parLapply(cl, X = crime$Location, fun = function(x) {
  as.numeric(
    unlist(
      strsplit(substr(x, 2, nchar(x) - 1), 
               split= &quot;, &quot;)[[1]][2] 
    )
  )
})

stopCluster(cl)
crime$lat &lt;- unlist(crime$lat)
crime$lon &lt;- unlist(crime$lon)
#############

## Filter out outlier longitude points
crime &lt;- crime %&gt;% 
  filter(crime$lon != 0)

## get contour lines that show regions by density
density.poly &lt;- contourLines(
  kde2d(crime$lon, crime$lat,
        lims = c(
          expand_range(range(crime$lon), add = 0.5),
          expand_range(range(crime$lat), add = 0.5)
        ))
)

## create column that subsequent loop will modify
crime$density &lt;- 0

## from highest to lowest density levels (which is default)
## get polygons, assign density val to points within them
for (i in 1:length(density.poly)) {
  hold.data &lt;- point.in.polygon(crime$lon, crime$lat, 
                                density.poly[[i]]$x, density.poly[[i]]$y)
  crime$density[which(hold.data==1)] &lt;- density.poly[[i]]$level
}

## create year column for animation iteration
crime &lt;- crime %&gt;% 
  mutate(Date.Occurred = as.Date(Date.Occurred, format = &quot;%m/%d/%Y&quot;)) %&gt;% 
  mutate(year = format(Date.Occurred, &quot;%Y&quot;)) %&gt;% 
  mutate(year = as.integer(year))

## Get Google Map Object from API
ggmap::register_google(key = &quot;AIzaSyBgYVpL1in38KcEnznCFwmRKz2d1VJKSe4&quot;)
ggmap_show_api_key()
la.map &lt;-   ggmap(get_googlemap(&quot;Los Angeles, California&quot;))

#### point with color test ####
crime.density &lt;- la.map +
  geom_point(crime, mapping = aes(x = lon, y = lat, 
                                  alpha = 0.01, 
                                  color = density,
                                  frame = year), size = 0.005, shape = &quot;.&quot;) +
  scale_color_gradient2(low = &quot;white&quot;, 
                       mid = &quot;lightblue&quot;, 
                       high = &quot;blue&quot;,
                       midpoint = mean(crime$density, na.rm = T)) +
  theme(
    legend.position=&#39;none&#39;
  )


animation::ani.options(interval = 2)

crime.density.anim &lt;- crime.density +
  transition_states(crime$year,
                    transition_length = 10,
                    state_length = 50) +
  labs(title = &quot;Year: {closest_state}&quot;)
                  
animate(crime.density.anim, nframes = 50)</code></pre>
</div>
</div>
<div id="section-los-angeles-crime-report-density-comparison-by-gender" class="section level1 tabset tabset-fade tabset-pills">
<h1>Los Angeles Crime Report Density Comparison By Gender</h1>
<div id="section-maps" class="section level2">
<h2>Maps</h2>
<div>
<table>
<tr>
<td style="padding:5px">
<h5>
Female Crime Reports, By Relative Density
</h5>
<img class="preload" src="https://github.com/CharlieCarter/CharlieCarter.github.io/blob/master/fem_crime.gif?raw=true">
</td>
<td style="padding:5px">
<h5>
Male Crime Reports, By Relative Density
</h5>
<img class="preload" src="https://github.com/CharlieCarter/CharlieCarter.github.io/blob/master/male_crime.gif?raw=true">
</td>
</tr>
</table>
</div>
</div>
<div id="section-code-1" class="section level2">
<h2>Code</h2>
<p>The software I was using on macOS, RMarkdown, does not always recognize path variables when specified in bash_profile. To stitch the images I produced together into gif’s, I had to use ImageMagick from my computer’s Terminal application. Otherwise, everything else was done with this R code.</p>
<pre class="r"><code>#### LIBRARIES ####

## DATA MANAGEMENT
library(tidyverse)
library(magrittr)
library(tictoc)
library(MASS)

## MAPS
library(sf)
library(rgdal)
# devtools::install_github(&quot;dkahle/ggmap&quot;, ref = &quot;tidyup&quot;, force=TRUE)
library(&quot;ggmap&quot;)
library(sp)
library(scales)

#Set your API Key
ggmap::register_google(key = &quot;AIzaSyBgYVpL1in38KcEnznCFwmRKz2d1VJKSe4&quot;)
# library(ggiraph)
# library(widgetframe)

## VISUALIZATION
# devtools::install_github(&#39;cran/ggplot2&#39;) 
library(ggplot2)
library(gganimate)
library(gifski)
## install.packages(&quot;/Users/charliecarter/Downloads/gifski_0.8.6.tar&quot;, repos = NULL,type = &quot;binary&quot;)


## get contour lines that define 
## point density circles
density.poly &lt;- contourLines(
  kde2d(crime$lon, crime$lat,
        lims = c(
          expand_range(range(crime$lon), add = 0.5),
          expand_range(range(crime$lat), add = 0.5)
        ))
)

## create column that loop will modify
crime$density &lt;- 0

## from highest to lowest density levels (which is default)
## get polygons and get points inside them, assign density val
for (i in 1:length(density.poly)) {
  hold.data &lt;- point.in.polygon(crime$lon, crime$lat, 
                                density.poly[[i]]$x, density.poly[[i]]$y)
  crime$density[which(hold.data==1)] &lt;- density.poly[[i]]$level
}


## trying alternative density measure
## https://slowkow.com/notes/ggplot2-color-by-density/

# Get density of points in 2 dimensions.
# @param x A numeric vector.
# @param y A numeric vector.
# @param n Create a square n by n grid to compute density.
# @return The density within each square.
get_density &lt;- function(x, y, ...) {
  dens &lt;- MASS::kde2d(x, y, ...)
  ix &lt;- findInterval(x, dens$x)
  iy &lt;- findInterval(y, dens$y)
  ii &lt;- cbind(ix, iy)
  return(dens$z[ii])
}

  fem.crime &lt;- crime %&gt;% 
    filter(Victim.Sex == &quot;F&quot;)

  male.crime &lt;- crime %&gt;% 
    filter(Victim.Sex == &quot;M&quot;)
  
  crime$dens_f &lt;- get_density(crime$lon, crime$lat, n= 400)

  fem.crime$dens_f &lt;-   get_density(fem.crime$lon, fem.crime$lat, n= 300)
  male.crime$dens_f &lt;-  get_density(male.crime$lon, male.crime$lat, n= 300)
  
## Create column with year data
crime &lt;- crime %&gt;% 
  mutate(Date.Occurred = as.Date(Date.Occurred, format = &quot;%m/%d/%Y&quot;)) %&gt;% 
  mutate(year = format(Date.Occurred, &quot;%Y&quot;)) %&gt;% 
  mutate(year = as.factor(year))


###########

# ggmap::register_google(key = &quot;AIzaSyBgYVpL1in38KcEnznCFwmRKz2d1VJKSe4&quot;)
# ggmap_show_api_key()
# la.map &lt;-   ggmap(get_googlemap(&quot;Los Angeles, California&quot;))
setwd(&quot;/Users/charliecarter/Documents/CalMatters/Data&quot;)
saveRDS(la.map, file = &quot;LA_map&quot;)

### FEMALE ####

  if(!dir.exists(&quot;/Users/charliecarter/examples&quot;)) {
    dir.create(&quot;/Users/charliecarter/examples&quot;)
  } 
  if(!dir.exists(&quot;/Users/charliecarter/examples/fem_crime&quot;)) {
    dir.create(&quot;/Users/charliecarter/examples/fem_crime&quot;)
  }
  setwd(&quot;/Users/charliecarter/examples/fem_crime&quot;)

# iterate over years and make map png&#39;s 
png(file=&quot;femcrime%02d.png&quot;, width=400, height=400)
for (year in levels(fem.crime$year)){
  print(year)
  #### point with color test ####
  crime.density &lt;- la.map +
    geom_point(fem.crime[fem.crime$year == year,1:ncol(fem.crime)], 
               mapping = aes(x = lon, 
                             y = lat,
                             alpha = 0.01,
                             color = dens_f), 
               size = 0.005, 
               shape = &quot;.&quot;) +
    scale_color_viridis_c(option = &quot;A&quot;, alpha = 0.5) + 
    labs(title = paste(&quot;Los Angeles Crime Reports With Female Victims,\nBy Density\nYear: &quot;,
                       year)) +
    theme(
      legend.position=&#39;none&#39;
    )
  plot(crime.density)
}
dev.off()


### MALE ####

  if(!dir.exists(&quot;/Users/charliecarter/examples&quot;)) {
    dir.create(&quot;/Users/charliecarter/examples&quot;)
  } 
  if(!dir.exists(&quot;/Users/charliecarter/examples/male_crime&quot;)) {
    dir.create(&quot;/Users/charliecarter/examples/male_crime&quot;)
  }
  setwd(&quot;/Users/charliecarter/examples/male_crime&quot;)

# iterate over years and make map png&#39;s 
png(file=&quot;malecrime%02d.png&quot;, width=400, height=400)
for (year in levels(male.crime$year)) {
  print(year)
  #### point with color test ####
  crime.density &lt;- la.map +
    geom_point(male.crime[male.crime$year == year, 1:ncol(male.crime)], 
               mapping = aes(x = lon, 
                             y = lat,
                             alpha = 0.01,
                             color = dens_f), 
               size = 0.005, 
               shape = &quot;.&quot;) +
    scale_color_viridis_c(option = &quot;A&quot;, alpha = 0.5) + 
    labs(title = paste(&quot;Los Angeles Crime Reports With Male Victims,\nBy Density\nYear: &quot;,
                       year)) +
    theme(
      legend.position=&#39;none&#39;
    )
  plot(crime.density)
}
dev.off()</code></pre>
</div>
</div>
<div id="section-shiny-test" class="section level1 tabset tabset-fade tabset-pills">
<h1>Shiny Test</h1>
<div id="section-shiny" class="section level2">
<h2>Shiny</h2>
<p><div class="form-group shiny-input-container">
<label class="control-label" for="bins">Number of bins:</label>
<input class="js-range-slider" id="bins" data-min="1" data-max="50" data-from="30" data-step="1" data-grid="true" data-grid-num="9.8" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number"/>
</div><div id="distPlot" class="shiny-plot-output" style="width: 100% ; height: 400px"></div></p>
</div>
<div id="section-empty" class="section level2">
<h2>Empty</h2>

<script type="application/shiny-prerendered" data-context="server">
output$distPlot <- renderPlot({
  x <- faithful[, 2]  # Old Faithful Geyser data
  bins <- seq(min(x), max(x), length.out = input$bins + 1)
  hist(x, breaks = bins, col = 'darkgray', border = 'white')
})
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery-1.11.3"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap-3.3.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery-1.11.3"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider"]},{"type":"character","attributes":{},"value":["2.1.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["href"]}},"value":[{"type":"character","attributes":{},"value":["shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css","css/ion.rangeSlider.skinShiny.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["href"]}},"value":[{"type":"character","attributes":{},"value":["shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"logical","attributes":{},"value":[true]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
